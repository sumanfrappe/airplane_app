{
  "version": 3,
  "sources": ["../../../../../apps/frappe/frappe/public/js/billing.bundle.js"],
  "sourcesContent": ["const frappeCloudBaseEndpoint = \"https://frappecloud.com\";\n\n$(document).ready(function () {\n\tif (\n\t\tfrappe.boot.fc_communication_secret &&\n\t\tfrappe.boot.setup_complete === 1 &&\n\t\t!frappe.is_mobile() &&\n\t\tfrappe.user.has_role(\"System Manager\")\n\t) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.integrations.frappe_providers.frappecloud_billing.current_site_info\",\n\t\t\tcallback: (r) => {\n\t\t\t\tconst response = r.message;\n\t\t\t\tif (response.trial_end_date) {\n\t\t\t\t\t$(\".layout-main-section\").before(\n\t\t\t\t\t\tgenerateTrialSubscriptionBanner(response.trial_end_date)\n\t\t\t\t\t);\n\n\t\t\t\t\t$(\".login-to-fc\").on(\"click\", function () {\n\t\t\t\t\t\tinitiateRequestForLoginToFrappeCloud();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n});\n\nfunction initiateRequestForLoginToFrappeCloud() {\n\tfrappe.confirm(__(\"Are you sure you want to login to Frappe Cloud dashboard?\"), () => {\n\t\trequestLoginToFC();\n\t});\n}\n\nfunction requestLoginToFC(freezing_msg = \"Initating login to Frappe Cloud...\") {\n\tfrappe.call({\n\t\tmethod: \"frappe.integrations.frappe_providers.frappecloud_billing.send_verification_code\",\n\t\tfreeze: true,\n\t\tfreeze_message: __(freezing_msg),\n\t\tcallback: function (r) {\n\t\t\tshowFCLoginDialog(r.message.email);\n\t\t\tsetErrorMessage(\"\");\n\t\t},\n\t\terror: function (r) {\n\t\t\tfrappe.throw(__(\"Failed to login to Frappe Cloud. Please try again\"));\n\t\t},\n\t});\n}\n\nfunction setErrorMessage(message) {\n\t$(\"#fc-login-error\").text(message);\n}\n\nfunction showFCLoginDialog(email) {\n\tif (!window.fc_login_dialog) {\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Login to Frappe Cloud\"),\n\t\t\tprimary_action_label: __(\"Verify\", null, \"Submit verification code\"),\n\t\t\tprimary_action: verifyCode,\n\t\t});\n\n\t\t$(d.body).html(\n\t\t\trepl(\n\t\t\t\t`<div>\n\t\t\t<p>We have sent the verification code to your email id <strong>${email}</strong></p>\n\t\t\t<div class=\"form-group mt-2\">\n\t\t\t\t<div class=\"clearfix\">\n\t\t\t\t\t<label class=\"control-label\" style=\"padding-right: 0px;\">Verification Code</label>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"control-input-wrapper\">\n\t\t\t\t\t<div class=\"control-input\"><input type=\"text\" class=\"input-with-feedback form-control\" id=\"fc-login-verification-code\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<p class=\"text-danger\" id=\"fc-login-error\"></p>\n\t\t</div>`,\n\t\t\t\tfrappe.app\n\t\t\t)\n\t\t);\n\n\t\td.add_custom_action(\"Didn't receive code? Resend\", () => {\n\t\t\td.hide();\n\t\t\trequestLoginToFC(\"Resending Verification Code...\");\n\t\t});\n\n\t\twindow.fc_login_dialog = d;\n\t}\n\n\tfunction verifyCode() {\n\t\tlet otp = $(\"#fc-login-verification-code\").val();\n\t\tif (!otp) {\n\t\t\treturn;\n\t\t}\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.integrations.frappe_providers.frappecloud_billing.verify_and_login\",\n\t\t\targs: {\n\t\t\t\tverification_code: otp,\n\t\t\t},\n\t\t\tfreeze: true,\n\t\t\tfreeze_message: __(\"Validating verification code...\"),\n\t\t\tcallback: function (r) {\n\t\t\t\tconst message = r.message;\n\t\t\t\tif (message.login_token) {\n\t\t\t\t\twindow.fc_login_dialog.hide();\n\t\t\t\t\twindow.open(\n\t\t\t\t\t\t`${frappeCloudBaseEndpoint}/api/method/press.api.developer.saas.login_to_fc?token=${message.login_token}`,\n\t\t\t\t\t\t\"_blank\"\n\t\t\t\t\t);\n\t\t\t\t\tfrappe.msgprint({\n\t\t\t\t\t\ttitle: __(\"Frappe Cloud Login Successful\"),\n\t\t\t\t\t\tindicator: \"green\",\n\t\t\t\t\t\tmessage: `<p>${__(\n\t\t\t\t\t\t\t\"You will be redirected to Frappe Cloud soon.\"\n\t\t\t\t\t\t)}</p><p>${__(\n\t\t\t\t\t\t\t\"If you haven't been redirected,\"\n\t\t\t\t\t\t)} <a href=\"${frappeCloudBaseEndpoint}/api/method/press.api.developer.saas.login_to_fc?token=${\n\t\t\t\t\t\t\tmessage.login_token\n\t\t\t\t\t\t}\" target=\"_blank\">${__(\"Click here to login\")}</a></p>`,\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tsetErrorMessage(\"Login failed. Please try again\");\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (r) {\n\t\t\t\tif (r.exc) {\n\t\t\t\t\tsetErrorMessage(JSON.parse(JSON.parse(r._server_messages)[0])[\"message\"]);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\twindow.fc_login_dialog.show();\n}\n\nfunction addLoginToFCDropdownItem() {\n\t$(\".dropdown-navbar-user .dropdown-menu .dropdown-item:nth-child(2)\").after(\n\t\t`<div class=\"dropdown-item login-to-fc\" target=\"_blank\">Login to Frappe Cloud</div>`\n\t);\n}\n\nfunction generateTrialSubscriptionBanner(trialEndDate) {\n\tconst trial_end_date = new Date(trialEndDate);\n\tconst today = new Date();\n\tconst diffTime = trial_end_date - today;\n\tconst trial_end_days = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n\tconst trial_end_string =\n\t\ttrial_end_days > 1 ? `${trial_end_days} days` : `${trial_end_days} day`;\n\n\treturn $(`\n\t\t\t<style>\n\t\t\t\t.trial-banner {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tjustify-content: space-between;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tbackground-color: var(--subtle-accent);\n\t\t\t\t\tborder-radius: var(--border-radius-md);\n\t\t\t\t\tbox-shadow: var(--shadow-sm);\n\t\t\t\t}\n\t\t\t\t.trial-banner > div {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tgap: 8px;\n\t\t\t\t}\n\t\t\t\t.trial-banner .info-icon {\n\t\t\t\t\tmargin: 4px 0;\n\t\t\t\t}\n\t\t\t\t.trial-banner > div > div {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t}\n\t\t\t\t.trial-banner .title {\n\t\t\t\t\tfont-size: var(--text-base);\n\t\t\t\t\tfont-weight: var(--weight-semibold);\n\t\t\t\t}\n\t\t\t\t.trial-banner .description {\n\t\t\t\t\tfont-size: var(--text-sm);\n\t\t\t\t\tcolor: var(--text-muted);\n\t\t\t\t}\n\t\t\t\t.trial-banner .upgrade-plan-button {\n\t\t\t\t\theight: fit-content;\n\t\t\t\t\tbackground-color: var(--fg-color);\n\t\t\t\t\tborder: 1px solid var(--gray-300);\n\t\t\t\t\tcolor: var(--gray-800);\n\t\t\t\t\tborder-radius: var(--border-radius);\n\t\t\t\t}\n\t\t\t\t.trial-banner .upgrade-plan-button:hover {\n\t\t\t\t\tborder-color: var(--gray-400);\n\t\t\t\t}\n\t\t\t</style>\n\t\t\t<div class=\"trial-banner px-3 py-2 my-2\">\n\t\t\t\t<div>\n\t\t\t\t\t<svg class=\"info-icon\" width=\"18\" height=\"18\" viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t\t\t<g clip-path=\"url(#clip0_3360_13841)\">\n\t\t\t\t\t\t\t<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M8 14.25C11.4518 14.25 14.25 11.4518 14.25 8C14.25 4.54822 11.4518 1.75 8 1.75C4.54822 1.75 1.75 4.54822 1.75 8C1.75 11.4518 4.54822 14.25 8 14.25ZM8 15.25C12.0041 15.25 15.25 12.0041 15.25 8C15.25 3.99594 12.0041 0.75 8 0.75C3.99594 0.75 0.75 3.99594 0.75 8C0.75 12.0041 3.99594 15.25 8 15.25ZM8 5.75C8.48325 5.75 8.875 5.35825 8.875 4.875C8.875 4.39175 8.48325 4 8 4C7.51675 4 7.125 4.39175 7.125 4.875C7.125 5.35825 7.51675 5.75 8 5.75ZM8.5 7.43555C8.5 7.1594 8.27614 6.93555 8 6.93555C7.72386 6.93555 7.5 7.1594 7.5 7.43555V11.143C7.5 11.4191 7.72386 11.643 8 11.643C8.27614 11.643 8.5 11.4191 8.5 11.143V7.43555Z\" fill=\"#171717\"/>\n\t\t\t\t\t\t</g>\n\t\t\t\t\t\t<defs>\n\t\t\t\t\t\t\t<clipPath id=\"clip0_3360_13841\">\n\t\t\t\t\t\t\t\t<rect width=\"16\" height=\"16\" fill=\"white\"/>\n\t\t\t\t\t\t\t</clipPath>\n\t\t\t\t\t\t</defs>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<span class=\"title\">\n\t\t\t\t\t\t\tYour trial ends in ${trial_end_string}.\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class=\"description\">\n\t\t\t\t\t\t\tPlease upgrade for uninterrupted services\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<button type=\"button\"\n\t\t\t\t\tclass=\"upgrade-plan-button login-to-fc px-2 py-1\"\n\t\t\t\t>\n\t\t\t\t\t<svg width=\"17\" height=\"16\" viewBox=\"0 0 17 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t\t\t<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M6.2641 1C5.5758 1 4.97583 1.46845 4.80889 2.1362L3.57555 7.06953C3.33887 8.01625 4.05491 8.93333 5.03077 8.93333H7.50682L6.72168 14.4293C6.68838 14.6624 6.82229 14.8872 7.04319 14.9689C7.26408 15.0507 7.51204 14.9671 7.63849 14.7684L13.2161 6.00354C13.6398 5.33782 13.1616 4.46667 12.3725 4.46667H9.59038L10.3017 1.62127C10.3391 1.4719 10.3055 1.31365 10.2108 1.19229C10.116 1.07094 9.97063 1 9.81666 1H6.2641ZM5.77903 2.37873C5.83468 2.15615 6.03467 2 6.2641 2H9.17627L8.46492 4.8454C8.42758 4.99477 8.46114 5.15302 8.55589 5.27437C8.65064 5.39573 8.79602 5.46667 8.94999 5.46667H12.3725L8.0395 12.2757L8.5783 8.50404C8.5988 8.36056 8.55602 8.21523 8.46105 8.10573C8.36608 7.99623 8.22827 7.93333 8.08332 7.93333H5.03077C4.70548 7.93333 4.4668 7.62764 4.5457 7.31207L5.77903 2.37873Z\" fill=\"currentColor\"/>\n\t\t\t\t\t</svg>\n\t\t\t\t\t${__(\"Upgrade plan\")}\n\t\t\t\t</button>\n\t\t\t</div>\n`);\n}\n"],
  "mappings": "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",
  "names": []
}
